<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Examination Portal</title>
    <style>
        @keyframes gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        :root { --primary: #2563eb; --success: #10b981; --glass: rgba(255, 255, 255, 0.98); }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(-45deg, #0f172a, #1e1b4b, #312e81); background-size: 400% 400%; animation: gradient 12s ease infinite; margin: 0; padding: 20px; min-height: 100vh; display: flex; justify-content: center; align-items: center; }
        .container { max-width: 850px; width: 100%; background: var(--glass); padding: 40px; border-radius: 25px; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .hidden { display: none; }
        .section { background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; border-left: 6px solid var(--primary); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        input, textarea { width: 100%; padding: 14px; margin: 12px 0; border: 2px solid #e2e8f0; border-radius: 12px; box-sizing: border-box; font-size: 1rem; }
        .btn { background: var(--primary); color: white; padding: 16px 30px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1rem; transition: 0.3s; }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .q-img { width: 100%; border-radius: 12px; margin-bottom: 15px; border: 1px solid #ddd; }
        .result-header { text-align: center; color: var(--primary); }
        .score-display { font-size: 3.5rem; font-weight: bold; color: var(--success); margin: 10px 0; }
    </style>
</head>
<body>

<div class="container">
    
    <div id="step-1">
        <h1 style="text-align: center; color: var(--primary); margin-top:0;">Academic Portal</h1>
        <p style="text-align: center;">Welcome. Please enter your authorized Index Number.</p>
        <input type="text" id="index-check" placeholder="Index Number (e.g., 202501)">
        <button class="btn" onclick="validateIndex()">Access Examination</button>
    </div>

    <div id="step-2" class="hidden">
        <h2 style="text-align: center;">Student Profile</h2>
        <input type="text" id="student-name" placeholder="Enter Full Name">
        <input type="text" id="student-class" placeholder="Enter Class/Form">
        <button class="btn" onclick="startExam()">Begin Assessment</button>
    </div>

    <div id="step-3" class="hidden">
        <form id="exam-form" action="https://formspree.io/f/mbdrpzdj" method="POST">
            <input type="hidden" name="Index" id="h-index">
            <input type="hidden" name="Name" id="h-name">
            <input type="hidden" name="Grade_Result" id="h-score">
            
            <div style="text-align: center;">
                <h2 id="display-name" style="margin-bottom:5px;">Exam Paper</h2>
                <p>Topic: The Industrial Revolution</p>
                <hr style="opacity: 0.1; margin: 20px 0;">
            </div>

            <div class="section">
                <h3>1. Definition (40 Marks)</h3>
                <p>Explain in your own words what the Industrial Revolution was and why it changed the world.</p>
                <img src="https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=800" class="q-img">
                <textarea name="Q1_Definition" id="q1" required placeholder="Your answer..."></textarea>
            </div>

            <div class="section">
                <h3>2. Major Nations (30 Marks)</h3>
                <p>Which four major countries were the leaders of the Industrial Revolution?</p>
                <input type="text" name="Q2_Countries" id="q2" required placeholder="List the countries here...">
            </div>

            <div class="section">
                <h3>3. Impact on Africa (30 Marks)</h3>
                <p>Discuss the positive and negative effects of industrialization on the African continent.</p>
                <textarea name="Q3_Africa_Impact" id="q3" required placeholder="Describe the impacts..."></textarea>
            </div>

            <button type="submit" class="btn" style="background: #e11d48;">Submit Final Script</button>
        </form>
    </div>

    <div id="step-4" class="hidden" style="text-align: center;">
        <h2 class="result-header">Submission Successful</h2>
        <div class="section" style="background: #f8fafc;">
            <p>Candidate: <strong id="res-name"></strong></p>
            <p>Index: <span id="res-idx"></span></p>
            <hr style="opacity: 0.1;">
            <p style="margin-bottom:0;">Your Calculated Score:</p>
            <div class="score-display" id="res-score">0%</div>
            <p id="res-status" style="font-size: 1.2rem; font-weight: bold; margin-top:0;"></p>
        </div>
        <p style="font-size: 0.9rem; color: #64748b;">A digital copy has been sent to your instructor for final review.</p>
        <button class="btn" onclick="location.reload()">Return to Portal Home</button>
    </div>

</div>

<script>
    const authorizedIndexes = ["202501", "202502", "202503", "202504", "202505", "202506", "202507", "202508", "202509", "202510"];
    let studentData = { index: "", name: "" };

    function validateIndex() {
        const val = document.getElementById('index-check').value.trim();
        if (authorizedIndexes.includes(val)) {
            studentData.index = val;
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');
        } else { alert("Access Denied: Index Number not recognized."); }
    }

    function startExam() {
        const name = document.getElementById('student-name').value.trim();
        if(name) {
            studentData.name = name;
            document.getElementById('display-name').innerText = "Candidate: " + name;
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-3').classList.remove('hidden');
        } else { alert("Please enter your name to proceed."); }
    }

    const form = document.getElementById('exam-form');
    form.onsubmit = async (e) => {
        e.preventDefault();

        // --- LENIENT AUTO-MARKING LOGIC ---
        let finalPoints = 0;
        const q1Val = document.getElementById('q1').value.toLowerCase();
        const q2Val = document.getElementById('q2').value.toLowerCase();
        const q3Val = document.getElementById('q3').value.toLowerCase();

        // Q1: Definition (Generous Keyword Check)
        const q1Keywords = ['machine', 'factory', 'steam', 'production', 'industry', 'technology', 'growth', 'change', 'transition'];
        let q1Hits = 0;
        q1Keywords.forEach(word => { if(q1Val.includes(word)) q1Hits++; });
        // If they hit 3 keywords, they get full 40 marks. If 2, they get 30.
        if(q1Hits >= 3) finalPoints += 40;
        else if(q1Hits >= 1) finalPoints += 25;

        // Q2: Countries (Flexible Names)
        const countryGroups = [
            ['britain', 'uk', 'united kingdom', 'england'],
            ['france'],
            ['usa', 'america', 'united states'],
            ['germany', 'deutschland']
        ];
        countryGroups.forEach(group => {
            if(group.some(name => q2Val.includes(name))) finalPoints += 7.5;
        });

        // Q3: Impact (Effort-Based Marking)
        if(q3Val.length > 60) finalPoints += 30; // Detailed answer
        else if(q3Val.length > 20) finalPoints += 15; // Short answer
        else if(q3Val.length > 5) finalPoints += 5; // Minimal effort

        const finalScore = Math.min(Math.round(finalPoints), 100);
        
        // Data Prep
        document.getElementById('h-index').value = studentData.index;
        document.getElementById('h-name').value = studentData.name;
        document.getElementById('h-score').value = finalScore + "%";

        // Button State
        const subBtn = form.querySelector('button');
        subBtn.innerText = "Processing Results...";
        subBtn.disabled = true;

        // AJAX Submission to Formspree
        try {
            await fetch(form.action, {
                method: 'POST',
                body: new FormData(form),
                headers: { 'Accept': 'application/json' }
            });
        } catch (err) {
            console.log("Submission error, showing result anyway.");
        }

        // Show Final Result
        document.getElementById('step-3').classList.add('hidden');
        document.getElementById('step-4').classList.remove('hidden');
        document.getElementById('res-name').innerText = studentData.name;
        document.getElementById('res-idx').innerText = studentData.index;
        document.getElementById('res-score').innerText = finalScore + "%";
        document.getElementById('res-status').innerText = finalScore >= 40 ? "STATUS: SATISFACTORY" : "STATUS: NEEDS REVIEW";
    };
</script>

</body>
</html>
